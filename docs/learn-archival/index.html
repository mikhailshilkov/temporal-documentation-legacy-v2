<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163137879-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-163137879-1")</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163137879-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-163137879-1")</script>

<title data-react-helmet="true">Archival | Temporal</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Archival | Temporal"><meta data-react-helmet="true" name="description" content="Archival is a feature that automatically moves workflow histories from persistence to another location after the retention period. The purpose of archival is to be able to keep histories as long as needed while not overwhelming the persistence store. There are two reasons you may want to keep the histories after the retention period has past:"><meta data-react-helmet="true" property="og:description" content="Archival is a feature that automatically moves workflow histories from persistence to another location after the retention period. The purpose of archival is to be able to keep histories as long as needed while not overwhelming the persistence store. There are two reasons you may want to keep the histories after the retention period has past:"><meta data-react-helmet="true" property="og:url" content="https://temporalio.github.io/docs/learn-archival">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg">


<link rel="stylesheet" href="/styles.253e64a9.css">


<link rel="preload" href="/styles.2e8c563f.js" as="script">

<link rel="preload" href="/runtime~main.08a2b794.js" as="script">

<link rel="preload" href="/main.396e1ee6.js" as="script">

<link rel="preload" href="/1.56a960ad.js" as="script">

<link rel="preload" href="/2.baf85c20.js" as="script">

<link rel="preload" href="/3.f2c34b4a.js" as="script">

<link rel="preload" href="/1be78505.8ca3838c.js" as="script">

<link rel="preload" href="/20ac7829.55ca918f.js" as="script">

<link rel="preload" href="/17896441.3aca8210.js" as="script">

<link rel="preload" href="/15892eda.f742e330.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/favicon.svg" alt="My Site Logo"><strong class="navbar__title">Temporal</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/overview">Docs</a><a activeclassname="navbar__link--active" to="https://temporal.io/careers" class="navbar__item navbar__link" href="https://temporal.io/careers">Jobs</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/temporalio/temporal" class="navbar__item navbar__link">GitHub</a><a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/temporalio/shared_invite/zt-c1e99p8g-beF7~ZZW2HP6gGStXD8Nuw" class="navbar__item navbar__link">Slack</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/favicon.svg" alt="My Site Logo"><strong class="navbar__title">Temporal</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/overview">Docs</a></li><li class="menu__list-item"><a activeclassname="navbar__link--active" to="https://temporal.io/careers" class="menu__link" href="https://temporal.io/careers">Jobs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/temporalio/temporal" class="menu__link">GitHub</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/temporalio/shared_invite/zt-c1e99p8g-beF7~ZZW2HP6gGStXD8Nuw" class="menu__link">Slack</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/license">MIT License</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installing-server">Installing Temporal</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-sdk-video-tutorial">SDK Video Tutorial</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Use Cases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-periodic">Periodic Execution</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-orchestration">Microservice Orchestration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-polling">Polling</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-event-driven">Event Driven Application</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-partitioned-scan">Storage Scan</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-batch-job">Batch Job</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-provisioning">Infrastructure Provisioning</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-cicd">CI/CD</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-operational-management">Operational Management</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-interactive">Interactive Application</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-dsl">DSL Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-big-ml">Big Data and ML</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Learn</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/learn-glossary">Glossary</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-workflows">Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-activities">Activities</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-events">Events</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-queries">Queries</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-topology">Deployment Topology</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-task-lists">Task Lists</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-server-configuration">Configuration</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/learn-archival">Archival</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-cross-dc-replication">Cross-DC Replication</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-workflow-filtering">Filtering Workflows</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Java SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/java-quick-start">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-workflow-interface">Workflow Interface</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-implementing-workflows">Implementing Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-starting-workflow-executions">Starting workflow executions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-activity-interface">Activity Interface</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-implementing-activities">Implementing activities</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-versioning">Versioning</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-distributed-cron">Distributed CRON</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Go SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/go-quick-start">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-workers">Worker Service</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-create-workflows">Creating Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-activities">Activities</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-execute-activity">Executing Activities</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-child-workflows">Child Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-retries">Activity and Workflow Retries</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-error-handling">Error Handling</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-signals">Signals</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-continue-as-new">ContinueAsNew</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-side-effect">SideEffect</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-queries">Queries</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-activity-async-completion">Asynchronous Activity Completion</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-workflow-testing">Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-versioning">Versioning</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-sessions">Sessions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-distributed-cron">Distributed CRON</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-tracing">Tracing and Context Propagation</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Archival</h1></header><div class="markdown"><p>Archival is a feature that automatically moves workflow histories from persistence to another location after the retention period. The purpose of archival is to be able to keep histories as long as needed while not overwhelming the persistence store. There are two reasons you may want to keep the histories after the retention period has past:
1. <strong>Compliance:</strong> For legal reasons histories may need to be stored for a long period of time.
2. <strong>Debugging:</strong> Old histories can still be accessed for debugging.</p><p>Archival is still in beta and there are three limits to its feature set:
1. <strong>Only Histories:</strong> Only histories are archived, visibility records are simply deleted after the retention period.
2. <strong>RunId Required:</strong> In order to access an archived history, both workflowId and runId are required.
3. <strong>Best Effort:</strong> There are cases in which a history can be deleted from persistence without being archived first. These cases are rare but are possible with the current state of archival.</p><p>Work is being prioritized on archival to eliminate these limitations.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="concepts"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#concepts" title="Direct link to heading">#</a>Concepts</h2><ul><li><strong>Archiver:</strong> Archiver is the component responsible for archiving and retrieving workflow histories.  Its interface is quite generic and supports different kinds of archival locations: local file system, S3, Kafka, etc. Check <a href="https://github.com/temporalio/temporal/blob/master/common/archiver/README.md">this README</a> for how to add a new archiver implementation.</li><li><strong>URI:</strong> An URI is used to specify the archival location. Based on the scheme part of an URI, the corresponding archiver will be selected by the system to perform archival.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configuring-archival"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-archival" title="Direct link to heading">#</a>Configuring Archival</h2><p>Archival is controlled by both namespace level config and cluster level config. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cluster-archival-config"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cluster-archival-config" title="Direct link to heading">#</a>Cluster Archival Config</h3><p>A Temporal cluster can be in one of three archival states:</p><ul><li><strong>Disabled:</strong> No archivals will occur and the archivers will be not initialized on startup.</li><li><strong>Paused:</strong> This state is not yet implemented. Currently setting cluster to paused is the same as setting it to disabled.</li><li><strong>Enabled:</strong> Archivals will occur.</li></ul><p>Enabling the cluster for archival simply means histories are being archived. There is another config which controls whether histories can be accessed from archival. Both these configs have defaults defined in static yaml, and have dynamic config overwrites. Note, however, dynamic config will take effect only when archival is enabled in static yaml.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="namespace-archival-config"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#namespace-archival-config" title="Direct link to heading">#</a>Namespace Archival Config</h3><p>A namespace includes two pieces of archival related config: </p><ul><li><strong>Status:</strong> Either enabled or disabled. If a namespace is in the disabled state no archivals will occur for that namespace.
A namespace can safely switch between statuses.</li><li><strong>URI:</strong> The scheme and location where histories will be archived to. When a namespace enables archival for the first time URI is set and can never be mutated. If URI is not specified when first enabling a namespace for archival, a default URI from static config will be used.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="running-locally"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-locally" title="Direct link to heading">#</a>Running Locally</h2><p>In order to run locally do the following:
1. <code>./temporal-server start</code>
2. <code>./tctl --ns samples-namespace namespace register --gd false --history_archival_status enabled --retention 0</code>
3. Run the <a href="https://github.com/temporalio/temporal-go-samples/tree/master/helloworld">helloworld temporal sample</a> by following the README
4. Copy the workflowId and runId of the completed workflow from log output
5. <code>./temporal --ns samples-namespace wf show --wid &lt;workflowId&gt; --rid &lt;runId&gt;</code></p><p>In step 2, we registered a new namespace and enabled history archival feature for that namespace. Since we didn&#x27;t provide an archival URI when registering the new namespace, the default URI specified in <code>config/development.yaml</code> is used. The default URI is <code>file:///tmp/temporal_archival/development</code>, so you can find the archived workflow history under the <code>/tmp/temporal_archival/development</code> directory. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="faq"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#faq" title="Direct link to heading">#</a>FAQ</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="how-does-archival-interact-with-global-namespaces"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-does-archival-interact-with-global-namespaces" title="Direct link to heading">#</a>How does archival interact with global namespaces?</h3><p>When archival occurs it will first run on the active side and some time later it will run on the standby side as well.
Before uploading history a check is done to see if it has already been uploaded, if so it is not re-uploaded.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="can-i-specify-multiple-archival-uris"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#can-i-specify-multiple-archival-uris" title="Direct link to heading">#</a>Can I specify multiple archival URIs?</h3><p>No, each namespace can only have one URI for history archival and one URI for visibility archival. Different namespaces, however, can have different URIs (with different schemes).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="how-does-archival-work-with-pii"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-does-archival-work-with-pii" title="Direct link to heading">#</a>How does archival work with PII?</h3><p>No temporal workflow should ever operate on clear text PII. Temporal can be thought
of as a database and just as one would not store PII in a database PII should not be
stored in Temporal. This is even more important when archival is enabled because
these histories can be kept forever. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="planned-future-work"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#planned-future-work" title="Direct link to heading">#</a>Planned Future Work</h2><ul><li>Support archival of visibility.</li><li>Support accessing histories without providing runId.</li><li>Provide hard guarantee that no history is deleted from persistence before being archived if archival is enabled.</li><li>Implement paused state. In this state no archivals will occur but histories also will not be deleted from persistence.
Once enabled again from paused state, all skipped archivals will occur. </li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/temporalio/temporal-documentation-legacy-v2/blob/master/docs/learn-archival.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/learn-server-configuration"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Configuring Temporal</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/learn-cross-dc-replication"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Cross-DC Replication »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#concepts" class="contents__link">Concepts</a></li><li><a href="#configuring-archival" class="contents__link">Configuring Archival</a><ul><li><a href="#cluster-archival-config" class="contents__link">Cluster Archival Config</a></li><li><a href="#namespace-archival-config" class="contents__link">Namespace Archival Config</a></li></ul></li><li><a href="#running-locally" class="contents__link">Running Locally</a></li><li><a href="#faq" class="contents__link">FAQ</a><ul><li><a href="#how-does-archival-interact-with-global-namespaces" class="contents__link">How does archival interact with global namespaces?</a></li><li><a href="#can-i-specify-multiple-archival-uris" class="contents__link">Can I specify multiple archival URIs?</a></li><li><a href="#how-does-archival-work-with-pii" class="contents__link">How does archival work with PII?</a></li></ul></li><li><a href="#planned-future-work" class="contents__link">Planned Future Work</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/overview">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/java-quick-start">Java SDK</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/go-quick-start">Go SDK</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/temporal-workflow">Stack Overflow</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/temporalio/shared_invite/zt-c1e99p8g-beF7~ZZW2HP6gGStXD8Nuw">Slack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/temporalio/temporal">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Temporal Technologies Inc.  All rights reserved. Copyright © 2020 Uber Technologies, Inc.</div></div></div></footer>
</div>

<script src="/styles.2e8c563f.js"></script>

<script src="/runtime~main.08a2b794.js"></script>

<script src="/main.396e1ee6.js"></script>

<script src="/1.56a960ad.js"></script>

<script src="/2.baf85c20.js"></script>

<script src="/3.f2c34b4a.js"></script>

<script src="/1be78505.8ca3838c.js"></script>

<script src="/20ac7829.55ca918f.js"></script>

<script src="/17896441.3aca8210.js"></script>

<script src="/15892eda.f742e330.js"></script>


</body>
</html>