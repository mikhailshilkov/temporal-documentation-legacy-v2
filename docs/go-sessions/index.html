<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163137879-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-163137879-1")</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163137879-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-163137879-1")</script>

<title data-react-helmet="true">Sessions | Temporal</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Sessions | Temporal"><meta data-react-helmet="true" name="description" content="The session framework provides a straightforward interface for scheduling multiple activities on a single worker without requiring you to manually specify the task list name. It also includes features like **concurrent session limitation** and **worker failure detection**."><meta data-react-helmet="true" property="og:description" content="The session framework provides a straightforward interface for scheduling multiple activities on a single worker without requiring you to manually specify the task list name. It also includes features like **concurrent session limitation** and **worker failure detection**."><meta data-react-helmet="true" property="og:url" content="https://temporalio.github.io/docs/go-sessions">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg">


<link rel="stylesheet" href="/styles.73ab9c40.css">


<link rel="preload" href="/styles.2e8c563f.js" as="script">

<link rel="preload" href="/runtime~main.3f5c8c97.js" as="script">

<link rel="preload" href="/main.df99bb28.js" as="script">

<link rel="preload" href="/1.56a960ad.js" as="script">

<link rel="preload" href="/2.baf85c20.js" as="script">

<link rel="preload" href="/3.f2c34b4a.js" as="script">

<link rel="preload" href="/1be78505.6525ab7f.js" as="script">

<link rel="preload" href="/20ac7829.52f9a0c2.js" as="script">

<link rel="preload" href="/17896441.3aca8210.js" as="script">

<link rel="preload" href="/11716ba2.08425390.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/favicon.svg" alt="My Site Logo"><strong class="navbar__title">Temporal</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/overview">Docs</a><a activeclassname="navbar__link--active" to="https://temporal.io/careers" class="navbar__item navbar__link" href="https://temporal.io/careers">Jobs</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/temporalio/temporal" class="navbar__item navbar__link">GitHub</a><a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/temporalio/shared_invite/zt-c1e99p8g-beF7~ZZW2HP6gGStXD8Nuw" class="navbar__item navbar__link">Slack</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/favicon.svg" alt="My Site Logo"><strong class="navbar__title">Temporal</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/overview">Docs</a></li><li class="menu__list-item"><a activeclassname="navbar__link--active" to="https://temporal.io/careers" class="menu__link" href="https://temporal.io/careers">Jobs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/temporalio/temporal" class="menu__link">GitHub</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/temporalio/shared_invite/zt-c1e99p8g-beF7~ZZW2HP6gGStXD8Nuw" class="menu__link">Slack</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/license">MIT License</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installing-server">Installing Temporal</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Use Cases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-periodic">Periodic Execution</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-orchestration">Microservice Orchestration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-polling">Polling</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-event-driven">Event Driven Application</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-partitioned-scan">Storage Scan</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-batch-job">Batch Job</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-provisioning">Infrastructure Provisioning</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-cicd">CI/CD</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-operational-management">Operational Management</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-interactive">Interactive Application</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-dsl">DSL Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/use-cases-big-ml">Big Data and ML</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Learn</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/learn-glossary">Glossary</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-workflows">Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-activities">Activities</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-events">Events</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-queries">Queries</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-topology">Deployment Topology</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-task-lists">Task Lists</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-server-configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-archival">Archival</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-cross-dc-replication">Cross-DC Replication</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-workflow-filtering">Filtering Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learn-cli">Command Line Interface</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Java SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/java-quick-start">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-workflow-interface">Workflow Interface</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-implementing-workflows">Implementing Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-starting-workflow-executions">Starting workflow executions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-activity-interface">Activity Interface</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-implementing-activities">Implementing activities</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-versioning">Versioning</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java-distributed-cron">Distributed CRON</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Go SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/go-quick-start">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-sdk-video-tutorial">SDK Video Tutorial</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-workers">Worker Service</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-create-workflows">Creating Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-activities">Activities</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-execute-activity">Executing Activities</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-child-workflows">Child Workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-retries">Activity and Workflow Retries</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-error-handling">Error Handling</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-signals">Signals</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-continue-as-new">ContinueAsNew</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-side-effect">SideEffect</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-queries">Queries</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-activity-async-completion">Asynchronous Activity Completion</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-workflow-testing">Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-versioning">Versioning</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/go-sessions">Sessions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-distributed-cron">Distributed CRON</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/go-tracing">Tracing and Context Propagation</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Sessions</h1></header><div class="markdown"><p>The session framework provides a straightforward interface for scheduling multiple activities on a single worker without requiring you to manually specify the task list name. It also includes features like <strong>concurrent session limitation</strong> and <strong>worker failure detection</strong>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="use-cases"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-cases" title="Direct link to heading">#</a>Use Cases</h2><ul><li><p><strong>File Processing</strong>: You may want to implement a workflow that can download a file, process it, and then upload the modified version. If these three steps are implemented as three different activities, all of them should be executed by the same worker.</p></li><li><p><strong>Machine Learning Model Training</strong>: Training a machine learning model typically involves three stages: download the data set, optimize the model, and upload the trained parameter. Since the models may consume a large amount of resources (GPU memory for example), the number of models processed on a host needs to be limited.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="basic-usage"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-usage" title="Direct link to heading">#</a>Basic Usage</h2><p>Before using the session framework to write your workflow code, you need to configure your worker to process sessions. To do that, set the <code>EnableSessionWorker</code> field of <code>worker.Options</code> to <code>true</code> when starting your worker.</p><p>The most important APIs provided by the session framework are <code>workflow.CreateSession()</code> and <code>workflow.CompleteSession()</code>. The basic idea is that all the activities executed within a session will be processed by the same worker and these two APIs allow you to create new sessions and close them after all activities finish executing.</p><p>Here&#x27;s a more detailed description of these two APIs:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> SessionOptions </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ExecutionTimeout: required, no default.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//     Specifies the maximum amount of time the session can run.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ExecutionTimeout time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Duration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// CreationTimeout: required, no default.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//     Specifies how long session creation can take before returning an error.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CreationTimeout  time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Duration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">CreateSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sessionOptions </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SessionOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p><code>CreateSession()</code> takes in <code>workflow.Context</code>, <code>sessionOptions</code> and returns a new context which contains metadata information of the created session (referred to as the <strong>session context</strong> below). When it&#x27;s called, it will check the task list name specified in the <code>ActivityOptions</code> (or in the <code>StartWorkflowOptions</code> if the task list name is not specified in <code>ActivityOptions</code>), and create the session on one of the workers which is polling that task list.</p><p>The returned session context should be used to execute all activities belonging to the session. The context will be cancelled if the worker executing this session dies or <code>CompleteSession()</code> is called. When using the returned session context to execute activities, a <code>workflow.ErrSessionFailed</code> error may be returned if the session framework detects that the worker executing this session has died. The failure of your activities won&#x27;t affect the state of the session, so you still need to handle the errors returned from your activities and call <code>CompleteSession()</code> if necessary.</p><p><code>CreateSession()</code> will return an error if the context passed in already contains an open session. If all the workers are currently busy and unable to handle new sessions, the framework will keep retrying until the <code>CreationTimeout</code> you specified in <code>SessionOptions</code> has passed before returning an error (check the <strong>Concurrent Session Limitation</strong> section for more details).</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">CompleteSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p><code>CompleteSession()</code> releases the resources reserved on the worker, so it&#x27;s important to call it as soon as you no longer need the session. It will cancel the session context and therefore all the activities using that session context. Note that it&#x27;s safe to call <code>CompleteSession()</code> on a failed session, meaning that you can call it from a <code>defer</code> function after the session is successfully created.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="sample-code"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#sample-code" title="Direct link to heading">#</a>Sample Code</h3><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">FileProcessingWorkflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fileID </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ao </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ActivityOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ScheduleToStartTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Second </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    StartToCloseTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">    time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Minute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ctx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">WithActivityOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  so </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SessionOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CreationTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Minute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ExecutionTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Minute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">CreateSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> so</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> err</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">defer</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">CompleteSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> fInfo </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">fileInfo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  err </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ExecuteActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> downloadFileActivityName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fileID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">fInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> err</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> fInfoProcessed </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">fileInfo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  err </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ExecuteActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> processFileActivityName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">fInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">fInfoProcessed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> err</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ExecuteActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uploadFileActivityName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">fInfoProcessed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="session-metadata"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#session-metadata" title="Direct link to heading">#</a>Session Metadata</h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> SessionInfo </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// A unique Id for the session</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SessionID         </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The hostname of the worker that is executing the session</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  HostName          </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ... other unexported fields</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">GetSessionInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SessionInfo</span></div></div></div></div></div><p>The session context also stores some session metadata, which can be retrieved by the <code>GetSessionInfo()</code> API. If the context passed in doesn&#x27;t contain any session metadata, this API will return a <code>nil</code> pointer.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="concurrent-session-limitation"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#concurrent-session-limitation" title="Direct link to heading">#</a>Concurrent Session Limitation</h2><p>To limit the number of concurrent sessions running on a worker, set the <code>MaxConcurrentSessionExecutionSize</code> field of <code>worker.Options</code> to the desired value. By default this field is set to a very large value, so there&#x27;s no need to manually set it if no limitation is needed.</p><p>If a worker hits this limitation, it won&#x27;t accept any new <code>CreateSession()</code> requests until one of the existing sessions is completed. <code>CreateSession()</code> will return an error if the session can&#x27;t be created within <code>CreationTimeout</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="recreate-session"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#recreate-session" title="Direct link to heading">#</a>Recreate Session</h2><p>For long-running sessions, you may want to use the <code>ContinueAsNew</code> feature to split the workflow into multiple runs when all activities need to be executed by the same worker. The <code>RecreateSession()</code>  API is designed for such a use case.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">RecreateSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> recreateToken </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sessionOptions </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SessionOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>Its usage is the same as <code>CreateSession()</code> except that it also takes in a <code>recreateToken</code>, which is needed to create a new session on the same worker as the previous one. You can get the token by calling the <code>GetRecreateToken()</code> method of the <code>SessionInfo</code> object.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">token </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">GetSessionInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sessionCtx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">GetRecreateToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="q--a"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#q--a" title="Direct link to heading">#</a>Q &amp; A</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="is-there-a-complete-example"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#is-there-a-complete-example" title="Direct link to heading">#</a>Is there a complete example?</h3><p>Yes, the <a href="https://github.com/temporalio/temporal-go-samples/blob/master/cmd/samples/fileprocessing/workflow.go">file processing example</a> in the temporal-go-samples repo has been updated to use the session framework.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="what-happens-to-my-activity-if-the-worker-dies"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-happens-to-my-activity-if-the-worker-dies" title="Direct link to heading">#</a>What happens to my activity if the worker dies?</h3><p>If your activity has already been scheduled, it will be cancelled. If not, you will get a <code>workflow.ErrSessionFailed</code> error when you call <code>workflow.ExecuteActivity()</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="is-the-concurrent-session-limitation-per-process-or-per-host"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#is-the-concurrent-session-limitation-per-process-or-per-host" title="Direct link to heading">#</a>Is the concurrent session limitation per process or per host?</h3><p>It&#x27;s per worker process, so make sure there&#x27;s only one worker process running on the host if you plan to use that feature.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="future-work"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#future-work" title="Direct link to heading">#</a>Future Work</h2><ul><li><p>Right now a session is considered failed if the worker process dies. However, for some use cases, you may only care whether worker host is alive or not. For these uses cases, the session should be automatically re-established if the worker process is restarted.</p></li><li><p>The current implementation assumes that all sessions are consuming the same type of resource and there&#x27;s only one global limitation. Our plan is to allow you to specify what type of resource your session will consume and enforce different limitations on different types of resources.</p></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/temporalio/temporal-documentation-legacy-v2/blob/master/docs/go-sessions.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/go-versioning"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Versioning</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/go-distributed-cron"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Distributed CRON »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#use-cases" class="contents__link">Use Cases</a></li><li><a href="#basic-usage" class="contents__link">Basic Usage</a><ul><li><a href="#sample-code" class="contents__link">Sample Code</a></li></ul></li><li><a href="#session-metadata" class="contents__link">Session Metadata</a></li><li><a href="#concurrent-session-limitation" class="contents__link">Concurrent Session Limitation</a></li><li><a href="#recreate-session" class="contents__link">Recreate Session</a></li><li><a href="#q--a" class="contents__link">Q &amp; A</a><ul><li><a href="#is-there-a-complete-example" class="contents__link">Is there a complete example?</a></li><li><a href="#what-happens-to-my-activity-if-the-worker-dies" class="contents__link">What happens to my activity if the worker dies?</a></li><li><a href="#is-the-concurrent-session-limitation-per-process-or-per-host" class="contents__link">Is the concurrent session limitation per process or per host?</a></li></ul></li><li><a href="#future-work" class="contents__link">Future Work</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/overview">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/java-quick-start">Java SDK</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/go-quick-start">Go SDK</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/temporal-workflow">Stack Overflow</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/temporalio/shared_invite/zt-c1e99p8g-beF7~ZZW2HP6gGStXD8Nuw">Slack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/temporalio/temporal">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Temporal Technologies Inc.  All rights reserved. Copyright © 2020 Uber Technologies, Inc.</div></div></div></footer>
</div>

<script src="/styles.2e8c563f.js"></script>

<script src="/runtime~main.3f5c8c97.js"></script>

<script src="/main.df99bb28.js"></script>

<script src="/1.56a960ad.js"></script>

<script src="/2.baf85c20.js"></script>

<script src="/3.f2c34b4a.js"></script>

<script src="/1be78505.6525ab7f.js"></script>

<script src="/20ac7829.52f9a0c2.js"></script>

<script src="/17896441.3aca8210.js"></script>

<script src="/11716ba2.08425390.js"></script>


</body>
</html>